---
import DrawerComponent from "./DrawerComponent.astro";

/**
 * Pages in the form: Home, Structure/Page1, Structure/Page2, Structure/Inner/Page3 etc.
 */
const allPages = [
    "Home",
    ...Object.keys(import.meta.glob(["../../pages/**/*.astro"]))
        .map((post) =>
            post
                .replace(/\.astro$/, "")
                .replace("../../pages/", "")
                .replace(/\/index$/, ""),
        )
        .filter((p) => p && p !== "index")
        .sort(),
];

export type NestedPages = {
    [key: string]: NestedPages | null;
};

const nestedPages: NestedPages = {};
for (const page of allPages) {
    const parts = page.split("/");
    let current = nestedPages;
    for (const part of parts) {
        if (!current[part]) {
            current[part] = {};
        }
        current = current[part] as NestedPages;
    }
}
---

<div class="drawer-side">
    <label
        for="navigation-drawer"
        aria-label="close sidebar"
        class="drawer-overlay"></label>

    <ul class="menu bg-base-200 text-base-content min-h-full w-80 p-4">
        <div class="mt-20"></div>
        {
            Object.entries(nestedPages).map(([parent, children]) => (
                <DrawerComponent
                    parent={parent}
                    children={children}
                    fullPath={parent === "Home" ? "/" : `/${parent}`}
                />
            ))
        }
    </ul>
</div>
